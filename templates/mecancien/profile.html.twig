{% extends 'layout.html.twig' %}

{% block title %}
    carhabty
{% endblock %}

{% block Head %}
    {{ parent() }}
    {% block LinksCss %}
        {{ parent() }}
        <link rel="stylesheet" href="{{ asset('css/stylebutton.css') }}">
    {% endblock %}
{% endblock %}

{% block Content %}
 {% block loader %}
  {{ parent() }}
 {% endblock %}
    {% if app.user %}
        {% if is_granted('ROLE_MECANICIEN') %}


<section class="py-5" style="background-color: #f5f5f5;">
	<div class="container">
		<div class="d-flex align-items-start">
			{% block sideHeader %}
				{{ parent() }}
			{% endblock %}
			<div class="aiz-user-panel">
				<div class="aiz-titlebar mt-2 mb-4">
					<div class="row align-items-center">
						<div class="col-md-6">
							<h4 class="h4">Configuration  Profile</h4>
						</div>
					</div>
				</div>

				<!-- Basic Info-->
				<div class="card">
					<div class="card-header">
						<h5 class="mb-0 h6">Information</h5>
					</div>
					<div class="card-body">
						<form enctype="multipart/form-data">
							<input type="hidden" name="_token" id="id" value="{{profileuser.id}}">
							<div class="form-group row">
								<label class="col-md-2 col-form-label">Nom</label>
								<div class="col-md-10">
									<input type="text" id="nom" class="form-control" placeholder="Your name" name="name" value="{{profileuser.nom}}">
								</div>
							</div>

							<div class="form-group row">
								<label class="col-md-2 col-form-label">Téléphone</label>
								<div class="col-md-10">
									<input type="text" id="numero" class="form-control" placeholder="Téléphone" name="phone" value="{{profileuser.tel1}}">
								</div>
							</div>
							<div class="form-group row">
								<label class="col-sm-2 col-from-label" for="name">Email</label>
								<div class="col-sm-10">
									<input type="email" id="eemail" class="form-control" placeholder="Email" name="email" value="{{profileuser.email}}">
								</div>
							</div>
							<div class="form-group row">
								<label class="col-md-2 col-form-label" for="signinSrEmail">Photo de profile
									<small>(90x90)</small>
								</label>
								<div class="col-md-10">
									<div class="input-group" data-toggle="aizuploader" data-type="image">
										<div class="input-group-prepend">
											<div class="input-group-text bg-soft-secondary font-weight-medium" onclick="cloudDinaryPhotoprofile()">Browse</div>
										</div>
										<div class="form-control file-amount" onclick="cloudDinaryPhotoprofile()"></div>
										<input type="hidden" id="srcLogo" name="avatar" class="selected-files" value="{{profileuser.photo}}">
									</div>
									<div class="file-preview box sm">
										<div class="d-flex justify-content-between align-items-center mt-2 file-preview-item" data-id="82" title="1626376579201 - Copie.jpg">
											<div class="align-items-center align-self-stretch d-flex justify-content-center thumb">
												<img src="{{profileuser.photo}}" id="logoImg" class="img-fit">
											</div>
											<div class="col body">
												<h6 class="d-flex">
													<span class="text-truncate title">Photo de profile</span>
													<span class="ext"></span>
												</h6>
												<p></p>
											</div>

										</div>
									</div>
								</div>
							</div>
							<div class="form-group row">
								<label class="col-sm-2 col-from-label" for="new_password">Nouveau mot de passe</label>
								<div class="col-sm-10">
									<input type="password" id="password" class="form-control" placeholder="Nouveau mot de passe" name="new_password">
								</div>
							</div>
							<div class="form-group row">
								<label class="col-sm-2 col-from-label" for="confirm_password">Confirmer mot de passe</label>
								<div class="col-sm-10">
									<input type="password" id="confirm_password" class="form-control" placeholder="Confirmer mot de passe" name="confirm_password">
								</div>
							</div>

							<div class="form-group mb-0 text-right">
								<button type="button" onclick="ModifierProfileCostumer()" class="btn btn-register btn-outline-light rounded-pill fs-14 fw-700 mb-5 mb-md-0">Modifier Profile</button>
							</div>
						</form>
					</div>
				</div>


			</div>
			<!-- /.aiz-user-panel -->
		</div>
		<!-- /.d-flex -->
	</div>
	<!-- /.container -->
</section>

        {% endif %}
    {% endif %}
{% endblock %}

{% block javascript %}
    {{ parent() }}
<script type="text/javascript">
 function cloudDinaryPhotoprofile() {
    // Afficher le preloader
    $('#cloudinaryPreloader').show();

    cloudinary.openUploadWidget({
        api_key: '539474279193439',
        api_secret: '7A1irSbuKcg2XIH1TLqB4pBUZfA',
        cloud_name: 'aladdineshoping',
        upload_preset: 'aladdineshop',
        folder: 'ml_default',
        theme: 'minimal',
        max_file_size: 300000000,
        image_metadata: true,
        client_allowed_formats: ["png", "jpeg"],
        resource_type: 'image',
        folder: 'folder',
        cropping: 'server',
        cropping_coordinates_mode: 'custom',
        cropping_aspect_ratio: 0.72,
        sources: ['local', 'url'],
        button_caption: 'Télécherger image',
    },
    (error, result) => { 
        // Masquer le preloader dès que Cloudinary ferme le popup
        $('#cloudinaryPreloader').hide();

        if (!error && result && result.event === "success") { 
            $("#srcLogo").val(result.info.secure_url);
            $('#logoImg').attr('src', result.info.secure_url).show();
            $('#NewPhotos').show();

            console.log('Done! Here is the image info: ', result.info.secure_url); 
        }
    });
}

    
    
    
    
    function ModifierProfileCostumer(){
        $_data = {};
        var pathModifProfile = '{{path('Modifier_profile_mecancien')}}';
    
        var id = $('#id').val();
        var nom = $('#nom').val();
        var email = $('#eemail').val();
        var numero = $('#numero').val();
        var password = $('#password').val();
        var confirm_password = $('#confirm_password').val();
        if($('#logoImg').val()!= ""){
          var logoImg = $('#logoImg').val();
        }else{
            var logoImg = $('#srcLogo').val();
        }
        
         
    
        $_data = {
            'id': id,
            'nom': nom,
            'email': email,
            'numero': numero,
            'password': password,
            'logoImg': logoImg
        };
    
        if($('#nom').val()!= "" && $('#eemail').val()!="" && $('#numero').val()!="" && $('#password').val()!= "" && ($('#confirm_password').val()== "" || $('#confirm_password').val()!= "") && password != confirm_password){
           Swal.fire({
    title: "Attention",
    text: "Les deux champs de mot de passe ne sont pas identiques !",
    icon: "warning",
    dangerMode: true,
})

        }else if($('#nom').val()!= "" && $('#eemail').val()!="" && $('#numero').val()!="" && $('#password').val()!= "" && $('#confirm_password').val()!= ""  && password == confirm_password) {
              $.ajax({
                type: "POST",
                url: pathModifProfile,
                data: $_data,
                success: function (response) {
                   Swal.fire({
                       title: "success!",
                       text: "Votre profile à été modifier avec succés!",
                       icon: "success",
                       
                      }); 
                    
                       
                   location.reload();
                    
    
    
                },
                beforeSend: function() { $('#loaderAcc1').show(); },
            complete: function() { $('#loaderAcc1').hide(); }
            })
        }else if ($('#nom').val()== ""){
            Swal.fire({
                           title: "Attention",
                           text: "merci de remplire le champ nom!",
                           icon: "warning",
                           dangerMode: true,
                        })
        }else if ($('#eemail').val()== "" ){
            Swal.fire({
                           title: "Attention",
                           text: "merci de remplire le champ email!",
                           icon: "warning",
                           dangerMode: true,
                        })
        }else if ( $('#password').val()!= "" && $('#confirm_password').val()== "" ){
            Swal.fire({
                           title: "Attention",
                           text: "merci de confirmer le mot de passe !",
                           icon: "warning",
                           dangerMode: true,
                        })
        }
    
        
        if ( $('#nom').val()!= "" && $('#eemail').val()!="" && $('#numero').val()!="" && $('#password').val()== ""){
             $.ajax({
                type: "POST",
                url: pathModifProfile,
                data: $_data,
                success: function (response) {
                   Swal.fire({
                       title: "success!",
                       text: "Votre profile à été modifier avec succés!",
                       icon: "success",
                       
                      }); 
                    
                       
                location.reload();
                    
    
    
                },
                beforeSend: function() { $('#loaderAcc1').show(); },
            complete: function() { $('#loaderAcc1').hide(); }
            })
        }else if ($('#nom').val()== ""){
            Swal.fire({
                           title: "Attention",
                           text: "merci de remplire le champ nom!",
                           icon: "warning",
                           dangerMode: true,
                        })
        }else if ($('#eemail').val()== "" ){
            Swal.fire({
                           title: "Attention",
                           text: "merci de remplire le champ email!",
                           icon: "warning",
                           dangerMode: true,
                        })
        }else if($('#numero').val()== "" ){
            Swal.fire({
                           title: "Attention",
                           text: "merci de remplire le champ telephone!",
                           icon: "warning",
                           dangerMode: true,
                        })
        }
        
    }
</script>{% endblock %}

