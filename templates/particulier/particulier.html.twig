{% extends 'layout.html.twig' %}

{% block title %}Essayara{% endblock %}

{% block Head %}
{{ parent() }}
{% block LinksCss %}
{{ parent() }} <link rel="stylesheet" href="{{ asset('css/stylebutton.css') }}"> 
<style>
/* Dégradés violets et bleus modernes */
.bg-grad-1 {
    background: linear-gradient(135deg, #7f00ff, #e100ff); /* violet intense vers rose */
}

/* Dégradés bleu-vert lumineux */
.bg-grad-2 {
    background: linear-gradient(135deg, #00f260, #0575e6); /* vert vif vers bleu vif */
}

/* Dégradés orange-chaud */
.bg-grad-3 {
    background: linear-gradient(135deg, #ff8008, #ffc837); /* orange vif vers jaune */
}
</style>


<style>
.badge-custom {
display: inline-block;
padding: 3px;
font-size: 11px;
border-radius: 0 50em 50em 0;
color: #ff0000;
font-weight: 600;
line-height: 26px;
position: absolute;
background: #fff;
z-index: 1;
top: 20px;
box-shadow: 2px 1px 6px 2px rgb(0 0 0 / 10%), 0 4px 4px 0px rgb(0 0 0 / 6%) !important;
}
.aiz-card-box {
transition: transform 0.3s ease, box-shadow 0.3s ease;
height: 100%;
}
.aiz-card-box:hover {
transform: translateY(-5px);
box-shadow: 0 12px 20px rgba(0,0,0,0.15);
}
.card-img {
width: 100%;
height: 180px;
object-fit: cover;
border-top-left-radius: .25rem;
border-top-right-radius: .25rem;
}
.icon-stat svg {
opacity: 0.7;
} </style>
{% endblock %}
{% endblock %}

{% block Content %}
{% if app.user and is_granted('ROLE_PARTICULIER') %}

<section class="py-5" style="background-color: #f5f5f5;">
    <div class="container">
        <div class="d-flex align-items-start">

        <!-- Sidebar -->
        <div class="col-lg-3">
            {% block sideHeader %}{{ parent() }}{% endblock %}
        </div>

        <!-- Dashboard + Dernières annonces -->
        <div class="col-lg-9">
            <!-- Statistiques -->
           <div class="aiz-user-panel">
							<div class="aiz-titlebar mt-2 mb-4">
								<div class="row align-items-center">
									<div class="col-md-6">
										<h4 class="h4 fw-bold">Mes statistiques</h4>
									</div>
								</div>
							</div>

							<div class="row gutters-10">
								<div class="col-md-4">
									<div class="bg-grad-1 text-white rounded-lg mb-4 overflow-hidden">
										<div class="px-3 pt-3">
											<div class="h3 fw-700">{{nbPieces}} Annonces
												</div>
											<div class="opacity-50"> publiées</div>
										</div>
										<svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 1440 320">
											<path fill="rgba(255,255,255,0.3)" d="M0,192L30,208C60,224,120,256,180,245.3C240,235,300,181,360,144C420,107,480,85,540,96C600,107,660,149,720,154.7C780,160,840,128,900,117.3C960,107,1020,117,1080,112C1140,107,1200,85,1260,74.7C1320,64,1380,64,1410,64L1440,64L1440,320L0,320Z"></path>
										</svg>
									</div>
								</div>

								<div class="col-md-4">
									<div class="bg-grad-2 text-white rounded-lg mb-4 overflow-hidden">
										<div class="px-3 pt-3">
											<div class="h3 fw-700"> 0 Messages</div>
											<div class="opacity-50">reçues</div>
										</div>
										<svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 1440 320">
											<path fill="rgba(255,255,255,0.3)" d="M0,128L34.3,112C68.6,96,137,64,206,96C274.3,128,343,224,411,250.7C480,277,549,235,617,213.3C685.7,192,754,192,823,181.3C891.4,171,960,149,1029,117.3C1097.1,85,1166,43,1234,58.7C1302.9,75,1371,149,1406,186.7L1440,224L1440,320L0,320Z"></path>
										</svg>
									</div>
								</div>

								<div class="col-md-4">
									<div class="bg-grad-3 text-white rounded-lg mb-4 overflow-hidden">
										<div class="px-3 pt-3">
											<div class="h3 fw-700">0 Piéces</div>
											<div class="opacity-50">vendues</div>
										</div>
										<svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 1440 320">
											<path fill="rgba(255,255,255,0.3)" d="M0,192L26.7,192C53.3,192,107,192,160,202.7C213.3,213,267,235,320,218.7C373.3,203,427,149,480,117.3C533.3,85,587,75,640,90.7C693.3,107,747,149,800,149.3C853.3,149,907,107,960,112C1013.3,117,1067,171,1120,202.7C1173.3,235,1227,245,1280,213.3C1333.3,181,1387,107,1413,69.3L1440,32L1440,320L0,320Z"></path>
										</svg>
									</div>
								</div>
							</div>
            <!-- Dernières annonces -->
            <div class="aiz-titlebar mt-2 mb-4">
								<div class="row align-items-center">
									<div class="col-md-6">
										<h4 class="h4 fw-bold">Mes dernières annonces</h4>
									</div>
								</div>
							</div>
            

            {% if annonces|length > 0 %}
            <div class="row g-3">
                {% for annonce in annonces %}
                    <div class="col-lg-3 col-md-6 col-sm-6">
                        <a href="" class="text-reset text-decoration-none">
                            <div class="aiz-card-box border border-light rounded shadow-sm hov-shadow-lg position-relative bg-white" style="min-height: 380px;">
                                <img class="card-img" src="{{ annonce.imagePrincipale }}" alt="{{ annonce.nom }}" onerror="this.onerror=null;this.src='{{ asset('images/placeholder.png') }}';">

                                <div class="p-3">
                                    <div class="fs-15 mb-1"><span class="fw-700 text-primary">{{ annonce.prix }} TND</span></div>
                                    <h3 class="fw-600 fs-14 text-truncate-2 mb-1">{{ annonce.nom }}</h3>
                                    <p class="mb-1 fs-12 text-muted d-flex align-items-center"><i class="las la-map-marker-alt me-1" style="font-size:14px; color:#555;"></i>{{ annonce.user.adresse ?: 'Adresse non renseignée' }}</p>
                                    <p class="mb-0 fs-12 text-muted d-flex align-items-center"><i class="las la-clock me-1" style="font-size:14px; color:#555;"></i><span class="time-ago" data-timestamp="{{ annonce.dateCreation|date('U') }}"></span></p>
                                </div>

                                <span class="badge-custom">Occasion</span>
                            </div>
                        </a>
                    </div>
                {% endfor %}
            </div>
            {% else %}
                <div class="alert alert-info">Vous n'avez pas encore publié d'annonces.</div>
            {% endif %}

        </div>
    </div>
</div>


</section>

{% endif %}
{% endblock %}

{% block javascript %}
{{ parent() }}

<script src="https://cdn.jsdelivr.net/npm/dayjs@1/dayjs.min.js"></script>

<script src="https://cdn.jsdelivr.net/npm/dayjs@1/plugin/relativeTime.js"></script>

<script src="https://cdn.jsdelivr.net/npm/dayjs@1/locale/fr.js"></script>

<script>
dayjs.extend(dayjs_plugin_relativeTime)
dayjs.locale('fr')
document.querySelectorAll('.time-ago').forEach(el => {
    let ts = el.dataset.timestamp
    el.textContent = dayjs.unix(ts).fromNow()
})
</script>

{% endblock %}
