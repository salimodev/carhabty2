{% extends 'layoutAdmin.html.twig' %}

{% block Head %}
    {{ parent() }}
    {% block LinksCss %}
        {{ parent() }}
        <link rel="stylesheet" href="{{ asset('css/style-detail-cos.css') }}">
       
    {% endblock %}
{% endblock %}

{% block title %}Mécanicien{% endblock %}
{% block loader %}{{ parent() }}{% endblock %}
{% block sidebar %}{{ parent() }}{% endblock %}

{% block page %}
{{ parent() }}
	<section class="py-5" style="background-color: #f5f5f5;">
    <div class="container">
        <div class="d-flex align-items-start">
            <div class="aiz-user-panel">
                <div class="aiz-titlebar mt-2 mb-4">
                    <div class="row align-items-center">
                        <div class="col-12">
                            <h1 class="h3">Demande Code : {{ demande.code }}</h1>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h5 class="h6 mb-0">Récapitulatif de la demande</h5>
                    </div>
                    <div class="card-body">
                        <div class="row">

                            <div class="col-12 col-lg-6">
                                <div class="table-responsive">
                                    <table class="table table-borderless">
                                        <tbody>
                                            <tr>
                                                <td class="w-50 fw-600">Code de demande:</td>
                                                <td>{{ demande.code }}</td>
                                            </tr>
                                            <tr>
                                                <td class="w-50 fw-600">Marque:</td>
                                                <td>{{ demande.marque }}</td>
                                            </tr>
                                            <tr>
                                                <td class="w-50 fw-600">Modèle:</td>
                                                <td>{{ demande.modele }}</td>
                                            </tr>
                                            <tr>
                                                <td class="w-50 fw-600">N° Châssis:</td>
                                                <td>{{ demande.chassis }}</td>
                                            </tr>
                                            <tr>
                                                <td class="w-50 fw-600">Énergie / Carburant:</td>
                                                <td>{{ demande.energie }}</td>
                                            </tr>
                                            <tr>
                                                <td class="w-50 fw-600">État du moteur:</td>
                                                <td>{{ demande.etatmoteur }}</td>
                                            </tr>
                                            <tr>
                                                <td class="w-50 fw-600">Zone:</td>
                                                <td>{{ demande.zone }}</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>

                            <div class="col-12 col-lg-6">
                                <div class="table-responsive">
                                    <table class="table table-borderless">
                                        <tbody>
                                            <tr>
                                                <td class="w-50 fw-600">Date de demande:</td>
                                                <td>{{ demande.datecreate|date('d/m/Y H:i') }}</td>
                                            </tr>
                                            <tr>
                                                <td class="w-50 fw-600">Statut:</td>
                                                <td>
                                                    {% if demande.statut == 'en_attente' %}
                                                        <span class="badge badge-inline badge-warning">en attente</span>
                                                    {% elseif demande.statut == 'publié' %}
                                                        <span class="badge badge-inline badge-primary">publié</span>
                                                    {% elseif demande.statut == 'fermer' %}
                                                        <span class="badge badge-inline badge-success">Servue</span>
                                                    {% endif %}
                                                </td>
                                            </tr>
                                            <tr>
                                                <td class="w-50 fw-600">Nombre d'offres reçues:</td>
                                                <td>
                                                    <span class="badge bg-warning">{{ offresRecues|length }}</span>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td class="w-50 fw-600">Photo carte grise:</td>
                                                <td>
                                                    {% if demande.photocartegrise %}
                                                        <img src="{{ demande.photocartegrise }}" alt="carte grise" class="img-fluid" style="max-width:222px; border-radius:6px;">
                                                    {% else %}
                                                        -
                                                    {% endif %}
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>

                        </div>
                    </div>
                </div>

                <div class="row mt-4">
                    <div class="col-12">
                        <div class="card">
                            <div class="card-header">
                                <h5 class="mb-0">Pièces demandées</h5>
                            </div>
                            <div class="card-body">
                                <div id="tab_wrapper" class="dataTables_wrapper dt-bootstrap4 no-footer">
                                    <div class="row">
                                        <div class="col-12">
                                            <div class="table-responsive">
                                                <table class="table table-striped" id="tab">
                                                    <thead>
                                                        <tr>
                                                            <th>#</th>
                                                            <th>Désignation</th>
                                                            <th>Référence</th>
                                                            <th>Photo</th>
                                                            <th>Observation</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                        {% for piece in pieces %}
                                                            <tr>
                                                                <td>{{ loop.index }}</td>
                                                                <td>{{ piece.designation }}</td>
                                                                <td>{{ piece.referance }}</td>
                                                                <td>
                                                                    {% if piece.photo %}
                                                                        <img src="{{ asset(piece.photo) }}" alt="photo pièce" class="img-fluid" width="80">
                                                                    {% else %}
                                                                        -
                                                                    {% endif %}
                                                                </td>
                                                                <td>{{ piece.observation ?: '-' }}</td>
                                                            </tr>
                                                        {% else %}
                                                            <tr>
                                                                <td colspan="5" class="text-center">Aucune pièce trouvée</td>
                                                            </tr>
                                                        {% endfor %}
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </div>
</section>

{% endblock %}

{% block javascript %}
{{ parent() }}
<script>
$(document).ready(function() {
    $('#mechantab').DataTable({
        language: { "url": 'https://cdn.datatables.net/plug-ins/1.13.6/i18n/fr-FR.json' },
        responsive: true
    });
    $('#offrestab').DataTable({
       language: { "url": 'https://cdn.datatables.net/plug-ins/1.13.6/i18n/fr-FR.json' },
        responsive: true
    });
});
</script>
{% endblock %}
