{% extends 'vendeurNeuf/layoutVN.html.twig' %}
{% block Head %}
	{{ parent() }}

	{% block LinksCss %}
		{{ parent() }}
		<link rel="stylesheet" href="{{ asset ('css/carousel.css') }}">
		<link rel="stylesheet" href="{{ asset ('css/carouselle.css') }}">
		<link rel="stylesheet" href="{{ asset ('css/fontawesome.css') }}">
        <link rel="stylesheet" href="{{ asset ('css/stylebutton.css') }}">
         <style>
       

         .btn:hover {
    color: #ffffff !important;
    text-decoration: none;
}
         		.btn-register:hover {
			background: linear-gradient(45deg, #ff8c00, #ff6b35);
			transform: translateY(-2px);
		}
        	.request-card {
			background: linear-gradient(135deg, #ffffff, #f7f8fc);
			border-radius: 15px;
			box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
			padding: 15px;
			transition: all 0.3s ease;
		}

		.request-card:hover {
			transform: translateY(-4px);
			box-shadow: 0 8px 20px rgba(255, 107, 53, 0.3);
		}

		.request-header {
			display: flex;
			justify-content: space-between;
			align-items: center;
			margin-bottom: 10px;
		}

		.request-title {
			font-weight: 700;
			font-size: 16px;
			color: #222;
			line-height: 1.3;
			flex: 1;
		}

		.request-badge {
			background: linear-gradient(135deg, #ff6b35 0%, #fca311 50%, #2ec4b6 100%);
			color: #fff;
			font-size: 12px;
			border-radius: 12px;
			padding: 5px 12px;
			font-weight: 700;
			letter-spacing: 0.5px;
			text-transform: uppercase;
			box-shadow: 0 2px 6px rgba(0, 0, 0, 0.15);
			display: inline-block;
			transition: all 0.3s ease;
		}

		.request-badge:hover {
			transform: scale(1.05);
			box-shadow: 0 4px 10px rgba(0, 0, 0, 0.25);
		}
		.request-header {
			display: flex;
			justify-content: space-between;
			align-items: center;
			margin-bottom: 8px;
		}


		.request-meta {
			font-size: 13px;
			color: #666;
			display: flex;
			justify-content: space-between;
			flex-wrap: wrap;
			gap: 4px;
			margin-bottom: 10px;
		}

		.request-image img {
			width: 100%;
			height: 220px;
			object-fit: cover;
			border-radius: 10px;
			margin-bottom: 10px;
		}

		.request-description {
			font-size: 14px;
			color: #333;
			line-height: 1.4;
			min-height: 50px;
			margin-bottom: 10px;
		}

		.request-meta {
			display: flex;
			flex-wrap: wrap;
			gap: 10px;
			color: #555;
			font-size: 14px;
			align-items: center;
			margin-bottom: 10px;
		}

		.request-meta i {
			color: #ff6b35;
			margin-right: 5px;
			font-size: 15px;
		}

		.btn-register i {
			margin-right: 8px;
			font-size: 16px;
			color: #fff;
		}
		.btn-register {
			background: linear-gradient(45deg, #ff6b35, #ff8c00);
			border: none;
			color: white;
			font-weight: 600;
			transition: 0.3s ease;
		}
		.btn-register:hover {
			background: linear-gradient(45deg, #ff8c00, #ff6b35);
			transform: translateY(-2px);
		}
		/* Effet au survol */
		.btn-register:hover {
			background: linear-gradient(45deg, #ff8c00, #ff6b35);
			transform: translateY(-2px);
			box-shadow: 0 4px 10px rgba(255, 107, 53, 0.4);
		}

		/* Animation de l'enveloppe quand la carte est survol√©e */
		.request-card:hover .btn-register i {
			animation: vibrate 0.3s linear infinite;
		}

		@keyframes vibrate {
			0% {
				transform: rotate(0deg);
			}
			25% {
				transform: rotate(10deg);
			}
			50% {
				transform: rotate(-10deg);
			}
			75% {
				transform: rotate(10deg);
			}
			100% {
				transform: rotate(0deg);
			}
		}
		/* üì± Responsive fixes */
		@media(max-width: 768px) {
			.request-card {
				padding: 12px;
				min-height: auto;
			}
			.request-title {
				font-size: 15px;
			}
			.request-meta {
				font-size: 12px;
			}
			.request-image img {
				height: 180px;
			}
		}


		.btn-propdemande {
			background: linear-gradient(45deg, #ff6b35, #ff9f1c);
			background: linear-gradient(45deg, #2ec4b6, #ff9f1c);
			color: white;
			box-shadow: 0 4px 15px rgba(255, 107, 53, 0.3);
		}


		.btn-offer {
			background-color: #ff4d00;
			color: white;
			border: none;
			width: 100%;
			padding: 10px;
			border-radius: 10px;
			font-weight: 600;
			cursor: pointer;
			transition: background 0.2s ease;
		}
		.btn-offer:hover {
			background-color: #e64300;
		}

		.badge-custom {
			display: inline-block;
			padding: 3px;
			font-size: 11px;
			border-radius: 0 50em 50em 0;
			color: #ffffff;
			font-weight: 600;
			line-height: 23px;
			position: absolute;
			background: linear-gradient(45deg, #ff6b35, #ff9f1c);
			z-index: 1;
			top: 20px;
			box-shadow: 2px 1px 6px 2px rgb(0 0 0 / 10%), 0 4px 4px 0 rgb(0 0 0 / 15%) !important;
		}
		.badge-custom .box {
			height: 26px;
			width: 26px;
			background: linear-gradient(45deg, #ff6b35, #ff9f1c);
			color: #fff;
			display: inline-block;
			border-radius: 50%;
			text-align: center;
		}
        </style>
	{% endblock %}

{% endblock %}

{% block title %}mes offres
{% endblock %}
{% block Header %}
	{{ parent() }}
{% endblock %}


{% block page %}
	{{ parent() }}
	{% block loader %}
		{{ parent() }}
	{% endblock %}
	{% if app.user %}
		{% if is_granted('ROLE_VENDEUR_NEUF') %}
	<div class="row">
		<div class="col-md-12">
			<div class="card">
				<div class="card-header">
					<h5 class="mb-0 h6">Derni√®res offres envoy√©es</h5>
				</div>
				<div class="card-body">
					{% if offres is not empty %}
						<table class="table table-hover mb-0 align-middle" id="tabprod1">
							<thead class="table-light">
								<tr>
									<th>#</th>
									<th>Num√©ro</th>
									<th>Demande</th>
									<th>Observation</th>
									<th>Date d‚Äôenvoi</th>
									<th>Validit√©</th>
									<th>Statut</th>
									<th>Action</th>
								</tr>
							</thead>
							<tbody>
								{% for offre in offres %}
									<tr>
										<td>{{ loop.index }}</td>
										<td class="fw-semibold text-primary">{{ offre.numeroOffre }}</td>
										<td>
											<a href="{{ path('detail_demande_accuill', {'id': offre.demande.id}) }}" class="text-decoration-none text-dark fw-semibold">
												{{ offre.demande.code ?? '‚Äî' }}
											</a>
										</td>
										<td>
											{{ offre.observation|length > 40 
                                            ? offre.observation|slice(0, 40) ~ '...' 
                                            : offre.observation }}
										</td>
										<td>{{ offre.createdAt|date('d/m/Y H:i') }}</td>
										<td>
											{% if offre.joursRestants > 0 %}
												{{ offre.joursRestants }}
												jour{{ offre.joursRestants > 1 ? 's' : '' }}
											{% else %}
												Expir√©e
											{% endif %}
										<td>
    {% if offre.status == 'acceptee' %}
        <span class="badge badge-inline badge-success">Accept√©e</span>
    {% elseif offre.status == 'refusee' %}
        <span class="badge badge-inline badge-danger">Refus√©e</span>
    {% else %}
        <span class="badge badge-inline badge-warning text-dark">En attente</span>
    {% endif %}
</td>
                                     <td class="text-right">
    {% if offre.status == 'en_attente' %}
        <a href="#" class="btn btn-soft-warning btn-icon btn-circle btn-sm"
           title="Modifier"
           onclick="modifierOffre({{ offre.id }})">
            <i class="las la-edit"></i>
        </a>
        <a href="#" class="btn btn-soft-danger btn-icon btn-circle btn-sm"
           title="Supprimer"
           onclick="supprimerOffre($(this), {{ offre.id }})">
            <i class="las la-trash"></i>
        </a>
    {% elseif offre.status == 'acceptee' %}
        <a href="#" class="btn btn-soft-success btn-icon btn-circle btn-sm"
           title="Offre accept√©e" disabled>
            <i class="las la-check"></i>
        </a>
    {% elseif offre.status == 'refusee' %}
        <a href="#" class="btn btn-soft-danger btn-icon btn-circle btn-sm"
           title="Offre refus√©e" disabled>
            <i class="las la-times"></i>
        </a>
    {% endif %}
</td>

									</tr>
								{% endfor %}
							</tbody>
						</table>
					{% else %}
						<p class="text-center text-muted">Aucune offre envoy√©e r√©cemment.</p>
					{% endif %}
				</div>
			</div>
		</div>
	</div>


		{% endif %}
	{% endif %}
{% endblock %}{% block footer %}{{ parent() }}{% endblock %}{% block javascript %}{{ parent() }}<script type="text/javascript" src="{{asset ('assets/js/carousel.js') }}"></script><script src="https://cdn.jsdelivr.net/npm/chart.js"></script><script type="text/javascript"></script><script type="text/javascript">
$(document).ready(function () {
var table = $('#tabprod').DataTable({
language: {
processing: "Traitement en cours...",
search: "Rechercher :",
lengthMenu: "Afficher _MENU_ √©l√©ments",
info: " _START_-_END_/_TOTAL_ √©l√©ments",
infoEmpty: " 0 -  0 / 0 √©l√©ments",
infoFiltered: "(filtr√© de _MAX_ √©l√©ments au total)",
infoPostFix: "",
loadingRecords: "Chargement en cours...",
zeroRecords: "Aucun √©l√©ment √† afficher",
emptyTable: "Aucun √©l√©ment √† afficher",
paginate: {
first: "Premier",
previous: "Pr√©c√©dent",
next: "Suivant",
last: "Dernier"
}
},
rowReorder: {
selector: 'td:nth-child(2)'
},
responsive: true
});
});


$(document).ready(function () {
var table = $('#tabprod1').DataTable({
language: {
processing: "Traitement en cours...",
search: "Rechercher :",
lengthMenu: "Afficher _MENU_ √©l√©ments",
info: " _START_-_END_/_TOTAL_ √©l√©ments",
infoEmpty: " 0 -  0 / 0 √©l√©ments",
infoFiltered: "(filtr√© de _MAX_ √©l√©ments au total)",
infoPostFix: "",
loadingRecords: "Chargement en cours...",
zeroRecords: "Aucun √©l√©ment √† afficher",
emptyTable: "Aucun √©l√©ment √† afficher",
paginate: {
first: "Premier",
previous: "Pr√©c√©dent",
next: "Suivant",
last: "Dernier"
}
},
rowReorder: {
selector: 'td:nth-child(2)'
},
responsive: true
});
});

function supprimerOffre(element, $id) {
$_data = {
'id': $id
},
Swal.fire({
title: '√ätes-vous s√ªr de vouloir supprimer cette demande ?',
type: 'warning',
showCancelButton: true,
confirmButtonColor: '#25a89d ',
cancelButtonColor: '#ff6b35',
confirmButtonText: 'Supprimer',
cancelButtonText: 'Annuler'
}).then((result) => {
if (result.value) {
$.ajax({
type: "POST",
url: "{{ path('retirer_offre') }}",
data: $_data,
success: function (response) {
element.parent().remove();
Swal.fire({title: "success!", text: "la  marque √† √©t√© supprimer avec succ√©s!", icon: "success"});


location.reload();
}
});
}
})
}




</script>
{% for message in app.flashes('success') %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        if (window.AIZ && AIZ.plugins && AIZ.plugins.notify) {
            AIZ.plugins.notify('success', '{{ message }}');
        } else {
            Swal.fire('Succ√®s', '{{ message }}', 'success');
        }
    });
</script>
{% endfor %}



{% endblock %}

