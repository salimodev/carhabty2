{% extends 'layout.html.twig' %}

{% block title %}
	Essayara
{% endblock %}

{% block Head %}
	{{ parent() }}
	{% block LinksCss %}
		{{ parent() }}
		<link rel="stylesheet" href="{{ asset('css/stylebutton.css') }}">

	{% endblock %}
{% endblock %}

{% block Content %}
	{% if app.user %}
		{% if is_granted('ROLE_MECANICIEN') %}
			<section class="py-5" style="background-color: #f5f5f5;">
				<div class="container">
					<div class="d-flex align-items-start">
						{% block sideHeader %}
							{{ parent() }}
						{% endblock %}

						<div class="aiz-user-panel">
							<div class="aiz-titlebar mt-2 mb-4">
								<div class="row align-items-center">
									<div class="col-md-6">
										<h4 class="h4">Mes statistiques</h4>
									</div>
								</div>
							</div>

							<div class="row gutters-10">
								<div class="col-md-4">
									<div class="bg-grad-1 text-white rounded-lg mb-4 overflow-hidden">
										<div class="px-3 pt-3">
											<div class="h3 fw-700">{{ demandeCount }}
												Demandes</div>
											<div class="opacity-50">envoyées</div>
										</div>
										<svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 1440 320">
											<path fill="rgba(255,255,255,0.3)" d="M0,192L30,208C60,224,120,256,180,245.3C240,235,300,181,360,144C420,107,480,85,540,96C600,107,660,149,720,154.7C780,160,840,128,900,117.3C960,107,1020,117,1080,112C1140,107,1200,85,1260,74.7C1320,64,1380,64,1410,64L1440,64L1440,320L0,320Z"></path>
										</svg>
									</div>
								</div>

								<div class="col-md-4">
									<div class="bg-grad-2 text-white rounded-lg mb-4 overflow-hidden">
										<div class="px-3 pt-3">
											<div class="h3 fw-700">{{ nbOffres }} Réponses</div>
											<div class="opacity-50">reçues</div>
										</div>
										<svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 1440 320">
											<path fill="rgba(255,255,255,0.3)" d="M0,128L34.3,112C68.6,96,137,64,206,96C274.3,128,343,224,411,250.7C480,277,549,235,617,213.3C685.7,192,754,192,823,181.3C891.4,171,960,149,1029,117.3C1097.1,85,1166,43,1234,58.7C1302.9,75,1371,149,1406,186.7L1440,224L1440,320L0,320Z"></path>
										</svg>
									</div>
								</div>

								<div class="col-md-4">
									<div class="bg-grad-3 text-white rounded-lg mb-4 overflow-hidden">
										<div class="px-3 pt-3">
											<div class="h3 fw-700">{{nbOffresAcceptees}} Devis</div>
											<div class="opacity-50">acceptés</div>
										</div>
										<svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 1440 320">
											<path fill="rgba(255,255,255,0.3)" d="M0,192L26.7,192C53.3,192,107,192,160,202.7C213.3,213,267,235,320,218.7C373.3,203,427,149,480,117.3C533.3,85,587,75,640,90.7C693.3,107,747,149,800,149.3C853.3,149,907,107,960,112C1013.3,117,1067,171,1120,202.7C1173.3,235,1227,245,1280,213.3C1333.3,181,1387,107,1413,69.3L1440,32L1440,320L0,320Z"></path>
										</svg>
									</div>
								</div>
							</div>

							<div class="aiz-titlebar mt-2 mb-4">
								<div class="row align-items-center">
									<div class="col-md-6">
										<h4 class="h4">Mes demandes</h4>
									</div>
								</div>
							</div>

							<div class="row">
								<div class="col-md-12">
									<div class="card">
										<div class="card-header">
											<h5 class="mb-0 h6">Demandes</h5>
										</div>
										<div class="card-body">
											<table id="tab" style="width:100%">
												<thead>
													<tr>
														<th>Code</th>
														<th>Marque</th>
														<th>Modèle</th>
														<th>N° Châssis</th>
														<th>Énergie</th>
														<th>État moteur</th>
														<th>Date</th>
														<th>Status</th>
														<th>Action</th>
													</tr>
												</thead>
												<tbody>
													{% for demande in demandes %}
														<tr>
															<td>
																<a href="{{path('detail_demande_mecan',{'code':demande.code})}}">{{ demande.code }}</a>
															</td>
															<td>{{ demande.marque }}</td>
															<td>{{ demande.modele }}</td>
															<td>{{ demande.chassis }}</td>
															<td>{{ demande.energie }}</td>
															<td>{{ demande.etatmoteur }}</td>
															<td>{{ demande.datecreate|date('d/m/Y H:i') }}</td>
															<td>
                                        {% if demande.statut == 'en_attente' %}
                                            <span class="badge badge-inline badge-warning">en attente</span>
                                             {% elseif demande.statut == 'publié' %}
                                              <span class="badge badge-inline badge-primary ">publié</span>
                                        {% elseif demande.statut == 'fermer' %}
                                            <span class="badge badge-inline badge-success">Servue</span>
                                        {% endif %}
                                    </td>
															<td class="text-right">
																<a class="btn btn-soft-success btn-icon btn-circle btn-sm" href="{{path('detail_demande_mecan',{'code':demande.code})}}">
																	<i class="las la-eye"></i>
																</a>
																<a onclick="supprimerdemande($(this),'{{ demande.id }}');" class="btn btn-soft-danger btn-icon btn-circle btn-sm" title="Supprimer">
																	<i class="las la-trash"></i>
																</a>

															</td>
														</tr>
													{% endfor %}
												</tbody>
											</table>
										</div>
									</div>
								</div>
							</div>
						</div>
						<!-- /.aiz-user-panel -->
					</div>
					<!-- /.d-flex -->
				</div>
				<!-- /.container -->
			</section>

		{% endif %}
	{% endif %}
{% endblock %}

{% block javascript %}
	{{ parent() }}

	<script type="text/javascript">
		$(document).ready(function () {
var table = $('#tab').DataTable({
language: {
url: "https://cdn.datatables.net/plug-ins/9dcbecd42ad/i18n/French.json"
},
rowReorder: {
selector: 'td:nth-child(2)'
},
responsive: true
});

});


function supprimerdemande(element, $id) {
$_data = {
'id': $id
},
Swal.fire({
title: 'Êtes-vous sûr de vouloir supprimer cette demande ?',
type: 'warning',
showCancelButton: true,
confirmButtonColor: '#25a89d ',
cancelButtonColor: '#ff6b35',
confirmButtonText: 'Supprimer',
cancelButtonText: 'Annuler'
}).then((result) => {
if (result.value) {
$.ajax({
type: "POST",
url: "{{ path('supprimer_demande') }}",
data: $_data,
success: function (response) {
element.parent().remove();
Swal.fire({title: "success!", text: "la demande à été supprimer avec succés!", icon: "success"});


location.reload();
}
});
}
})
}
	</script>

{% endblock %}

