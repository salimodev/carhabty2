{% extends 'layout.html.twig' %}

{% block title %}
	carhabty
{% endblock %}

{% block Head %}
	{{ parent() }}
	{% block LinksCss %}
		{{ parent() }}
		<link rel="stylesheet" href="{{ asset('css/stylebutton.css') }}">
	{% endblock %}
{% endblock %}

{% block Content %}
	
			<section class="py-5" style="background-color: #f5f5f5;">
				<div class="container">
					<div class="d-flex align-items-start">
						
						<div class="aiz-user-panel">
							<div class="aiz-titlebar mt-2 mb-4" style="margin-right: 1rem;">
    <div class="row align-items-center justify-content-between">
        <div class="col-md-6">
           
        </div>

        <div class="col-md-6 text-end">
        {% set dejaPropose = demande.offres|filter(o => o.user.id == app.user.id)|length > 0 %}
{% set estVendeurNeuf = app.user and 'ROLE_VENDEUR_NEUF' in app.user.roles %}

{% if app.user %}
    {% if estVendeurNeuf %}
        {% if dejaPropose %}
            <button type="button"
                    class="btn btn-primary btn-lg rounded-pill shadow-sm"
                    onclick="AIZ.plugins.notify('danger', 'Vous avez déjà proposé une offre pour cette demande !');"
                    style="background: linear-gradient(90deg, #007bff, #00c6ff); border:none; font-weight:600; width:200px;">
                Proposer un prix
            </button>
        {% else %}
            <form action="{{ path('propose_offre', {'id': demande.id}) }}" class="d-inline">
                <button type="submit"
                        class="btn btn-primary btn-lg rounded-pill shadow-sm"
                        style="background: linear-gradient(90deg, #007bff, #00c6ff); border:none; font-weight:600; width:200px;">
                    Proposer un prix
                </button>
            </form>
        {% endif %}
    {% else %}
        <button type="button"
                class="btn btn-primary btn-lg rounded-pill shadow-sm"
                onclick="AIZ.plugins.notify('warning', 'Seuls les vendeurs de pièces neuves peuvent proposer une offre.');"
                style="background: linear-gradient(90deg, #007bff, #00c6ff); border:none; font-weight:600; width:200px;">
                 Proposer un prix
        </button>
    {% endif %}
{% else %}
    <button type="button"
           class="btn btn-primary btn-lg rounded-pill shadow-sm"
            onclick="AIZ.plugins.notify('info', 'Veuillez vous connecter pour proposer une offre.');"
             style="background: linear-gradient(90deg, #007bff, #00c6ff); border:none; font-weight:600; width:200px;">
                 Proposer un prix
    </button>
{% endif %}

        </div>
    </div>
</div>


							<div class="card">
								<div class="card-header">
									<h5 class="h6 mb-0">Récapitulatif de la demande</h5>
								</div>
								<div class="card-body">
									<div class="row">

										<div class="col-lg-6">
											<table class="table-borderless table">
												<tbody>
													<tr>
														<td class="w-50 fw-600">Code de demande::</td>
														<td>{{ demande.code }}</td>
													</tr>
													<tr>
														<td class="w-50 fw-600">Marque:</td>
														<td>{{ demande.marque }}</td>
													</tr>
													<tr>
														<td class="w-50 fw-600">Modèle:</td>
														<td>{{ demande.modele }}</td>
													</tr>
													<tr>
														<td class="w-50 fw-600">N° Châssis:</td>
														<td>{{ demande.chassis }}</td>
													</tr>
													<tr>
														<td class="w-50 fw-600">Énergie / Carburant:</td>
														<td>{{ demande.energie }}</td>
													</tr>
													<tr>
														<td class="w-50 fw-600">État du moteur:</td>
														<td>{{ demande.etatmoteur }}</td>
													</tr>
													<tr>
														<td class="w-50 fw-600">Zone:</td>
														<td>{{ demande.zone }}</td>
													</tr>

												</tbody>
											</table>
										</div>
										<div class="col-lg-6">
											<table class="table-borderless table">
												<tbody>
													<tr>
														<td class="w-50 fw-600">Date de demande:</td>
														<td>{{demande.datecreate|date('d/m/Y H:i') }}</td>
													</tr>
													<tr>
														<td class="w-50 fw-600">Statut:</td>
														<td>
															{% if demande.statut == 'ouvert' %}
																<span class="badge badge-inline badge-success">ouvert</span>
															{% elseif demande.statut == 'fermé' %}
																<span class="badge badge-inline badge-danger">fermé</span>
															{% endif %}
														</td>
													</tr>
													<tr>
														<td class="w-50 fw-600">Photo carte grise:</td>
														<td><img src="{{ demande.photocartegrise }}" alt='carte grise' style='width:222px;height:135px;border-radius:6px;'></td>
													</tr>


												</tbody>
											</table>
										</div>
									</div>
								</div>
							</div>

							<div class="row">
								<div class="col-md-12">
									<div class="card">
										<div class="card-header">
											<h5 class="h6 mb-0">Détails de la demande</h5>
										</div>
										<div class="card-body">
											<div id="tab_wrapper" class="dataTables_wrapper dt-bootstrap4 no-footer">

												<div class="row">
													<div class="col-sm-12">
														<table class="table table-striped" id="tab">
															<thead>
																<tr>
																	<th>#</th>
																	<th>Désignation</th>
																	<th>Référence</th>
																	<th>Photo</th>
																	<th>Observation</th>
																</tr>
															</thead>
															<tbody>
																{% for piece in pieces %}
																	<tr>
																		<td>{{ loop.index }}</td>
																		<td>{{ piece.designation }}</td>
																		<td>{{ piece.referance }}</td>
																		<td>
																			{% if piece.photo %}
																				<img src="{{ asset(piece.photo) }}" alt="photo pièce" width="80">
																			{% else %}
																				-
																			{% endif %}
																		</td>
																		<td>{{ piece.observation ?: '-' }}</td>
																	</tr>
																{% else %}
																	<tr>
																		<td colspan="5" class="text-center">Aucune pièce trouvée</td>
																	</tr>
																{% endfor %}
															</tbody>
														</table>
													</div>
												</div>
												
											</div>
										</div>
									</div>
								</div>

							</div>
						</div>
					</div>
				</div>
				<!-- /.container -->
			</section>
	
{% endblock %}

{% block javascript %}
	{{ parent() }}
	<script type="text/javascript">
		$(document).ready(function () {
var table = $('#tab').DataTable({
 language: {
        url: "https://cdn.datatables.net/plug-ins/1.13.6/i18n/fr-FR.json"
    },
rowReorder: {
selector: 'td:nth-child(2)'
},
responsive: true
});
});
	</script>
{% endblock %}

