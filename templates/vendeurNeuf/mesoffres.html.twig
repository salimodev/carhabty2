{% extends 'vendeurNeuf/layoutVN.html.twig' %}
{% block Head %}
    {{ parent() }}
    {% block LinksCss %}
        {{ parent() }}
        <link rel="stylesheet" href="{{ asset ('css/carousel.css') }}">
        <link rel="stylesheet" href="{{ asset ('css/carouselle.css') }}">
        <link rel="stylesheet" href="{{ asset ('css/fontawesome.css') }}">
        <link rel="stylesheet" href="{{ asset('css/stylebutton.css') }}">

        <style>
            /* Mobile responsive */
            @media (max-width: 768px) {
                body, html {
                    padding: 0 !important;
                    margin: 0 !important;
                    overflow-x: hidden !important;
                }

                .container-fluid,
                .card,
                .card-body,
                .row {
                    padding-left: 0 !important;
                    padding-right: 0 !important;
                    margin-left: 0 !important;
                    margin-right: 0 !important;
                }

                .table-responsive {
                    overflow-x: auto !important; /* scroll horizontal si trop large */
                }

                table th, table td {
                    font-size: 0.85rem !important; /* réduire taille texte */
                    white-space: nowrap; /* éviter le wrapping des colonnes */
                }

                .btn-icon {
                    margin: 2px 2px !important;
                }

                .col-12 {
                    padding-left: 0 !important;
                    padding-right: 0 !important;
                }
            }
        </style>
    {% endblock %}
{% endblock %}


{% block title %}mes offres
{% endblock %}
{% block Header %}
	{{ parent() }}
{% endblock %}

{% block page %}
    {{ parent() }}
    {% block loader %}
        {{ parent() }}
    {% endblock %}

    {% if app.user and is_granted('ROLE_VENDEUR_NEUF') %}
        <div class="container-fluid px-md-4 px-2"> {# padding normal sur desktop, réduit sur mobile #}
            <div class="row">
                <div class="col-12">
                    <div class="card">
                        <div class="card-header">
                            <h5 class="mb-0 h6">Dernières offres envoyées</h5>
                        </div>
                       <div class="card-body p-0">
    {% if offres is not empty %}
        <div class="table-responsive" style="overflow-x: hidden;"> {# empêche le scroll #}
            <table class="table table-hover mb-0 align-middle" id="tabprod1">
                <thead class="table-light">
                    <tr>
                        <th>#</th>
                        <th>Numéro</th>
                        <th>Demande</th>
                        <th>Demandeur</th>
                        <th>Observation</th>
                        <th>Date d’envoi</th>
                        <th>Validité</th>
                        <th>Statut</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody>
                    {% for offre in offres %}
                        <tr>
                            <td>{{ loop.index }}</td>
                            <td class="fw-semibold text-primary">{{ offre.numeroOffre }}</td>
                            <td>
                                <a href="{{ path('detail_demande_accuill', {'id': offre.demande.id}) }}" class="text-decoration-none text-dark fw-semibold">
                                    {{ offre.demande.code ?? '—' }}
                                </a>
                            </td>
                            <td>
                                {% if offre.demande.offrecompte %}
                                    {{ offre.demande.offrecompte.nom ?? offre.demande.offrecompte.email }}
                                {% else %}
                                    <span class="text-muted">{{ offre.demande.offreemail }}</span>
                                {% endif %}
                            </td>
                            <td>{{ offre.observation|length > 40 ? offre.observation|slice(0, 40) ~ '...' : offre.observation }}</td>
                            <td>{{ offre.createdAt|date('d/m/Y H:i') }}</td>
                            <td>
                                {% if offre.joursRestants > 0 %}
                                    {{ offre.joursRestants }} jour{{ offre.joursRestants > 1 ? 's' : '' }}
                                {% else %}
                                    Expirée
                                {% endif %}
                            </td>
                            <td>
                                {% if offre.status == 'acceptee' %}
                                    <span class="badge badge-inline badge-success">Acceptée</span>
                                {% elseif offre.status == 'refusee' %}
                                    <span class="badge badge-inline badge-danger">Refusée</span>
                                {% else %}
                                    <span class="badge badge-inline badge-warning text-dark">En attente</span>
                                {% endif %}
                            </td>
                           <td class="text-right">
												{% if offre.status == 'en_attente' %}
													<a href="{{ path('offre_edit', {'id': offre.id}) }}" class="btn btn-soft-warning btn-icon btn-circle btn-sm" title="Modifier">
														<i class="las la-edit"></i>
													</a>
													<a href="#" class="btn btn-soft-danger btn-icon btn-circle btn-sm" title="Supprimer" onclick="supprimerOffre($(this), {{ offre.id }})">
														<i class="las la-trash"></i>
													</a>
												{% endif %}

												{# Nouveau bouton "Voir l'offre" disponible pour tous les statuts #}
												<a href="{{ path('offre_show', {'id': offre.id}) }}" class="btn btn-soft-info btn-icon btn-circle btn-sm" title="Voir l'offre">
													<i class="las la-eye"></i>
												</a>

												{% if offre.status == 'acceptee' %}
													<a href="#" class="btn btn-soft-success btn-icon btn-circle btn-sm" title="Offre acceptée" disabled>
														<i class="las la-check"></i>
													</a>
												{% elseif offre.status == 'refusee' %}
													<a href="#" class="btn btn-soft-danger btn-icon btn-circle btn-sm" title="Offre refusée" disabled>
														<i class="las la-times"></i>
													</a>
												{% endif %}
											</td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    {% else %}
        <p class="text-center text-muted m-3">Aucune offre envoyée récemment.</p>
    {% endif %}
</div>

                    </div>
                </div>
            </div>
        </div>
    {% endif %}
{% endblock %}




	
	
	
	{% block footer %}{{ parent() }}{% endblock %}{% block javascript %}{{ parent() }}<script type="text/javascript" src="{{asset ('assets/js/carousel.js') }}"></script><script src="https://cdn.jsdelivr.net/npm/chart.js"></script><script type="text/javascript"></script><script type="text/javascript">
$(document).ready(function () {
var table = $('#tabprod').DataTable({
language: {
processing: "Traitement en cours...",
search: "Rechercher :",
lengthMenu: "Afficher _MENU_ éléments",
info: " _START_-_END_/_TOTAL_ éléments",
infoEmpty: " 0 -  0 / 0 éléments",
infoFiltered: "(filtré de _MAX_ éléments au total)",
infoPostFix: "",
loadingRecords: "Chargement en cours...",
zeroRecords: "Aucun élément à afficher",
emptyTable: "Aucun élément à afficher",
paginate: {
first: "Premier",
previous: "Précédent",
next: "Suivant",
last: "Dernier"
}
},
rowReorder: {
selector: 'td:nth-child(2)'
},
responsive: true
});
});


$(document).ready(function () {
var table = $('#tabprod1').DataTable({
language: {
processing: "Traitement en cours...",
search: "Rechercher :",
lengthMenu: "Afficher _MENU_ éléments",
info: " _START_-_END_/_TOTAL_ éléments",
infoEmpty: " 0 -  0 / 0 éléments",
infoFiltered: "(filtré de _MAX_ éléments au total)",
infoPostFix: "",
loadingRecords: "Chargement en cours...",
zeroRecords: "Aucun élément à afficher",
emptyTable: "Aucun élément à afficher",
paginate: {
first: "Premier",
previous: "Précédent",
next: "Suivant",
last: "Dernier"
}
},
rowReorder: {
selector: 'td:nth-child(2)'
},
responsive: true
});
});

function supprimerOffre(element, $id) {
$_data = {
'id': $id
},
Swal.fire({
title: 'Êtes-vous sûr de vouloir supprimer cette demande ?',
type: 'warning',
showCancelButton: true,
confirmButtonColor: '#25a89d ',
cancelButtonColor: '#ff6b35',
confirmButtonText: 'Supprimer',
cancelButtonText: 'Annuler'
}).then((result) => {
if (result.value) {
$.ajax({
type: "POST",
url: "{{ path('retirer_offre') }}",
data: $_data,
success: function (response) {
element.parent().remove();
Swal.fire({title: "success!", text: "la  marque à été supprimer avec succés!", icon: "success"});


location.reload();
}
});
}
})
}




</script>
{% for message in app.flashes('success') %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        if (window.AIZ && AIZ.plugins && AIZ.plugins.notify) {
            AIZ.plugins.notify('success', '{{ message }}');
        } else {
            Swal.fire('Succès', '{{ message }}', 'success');
        }
    });
</script>
{% endfor %}



{% endblock %}

