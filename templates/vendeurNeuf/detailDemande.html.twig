{% extends 'vendeurNeuf/layoutVN.html.twig' %}

{% block Head %}
	{{ parent() }}

	{% block LinksCss %}
		{{ parent() }}
		<link rel="stylesheet" href="{{ asset('css/fontawesome.css') }}">
		<link rel="stylesheet" href="{{ asset ('css/stylebutton.css') }}">
		<style>/* Conteneur du bouton aligné à droite */
.bouton-droite {
    display: flex;
    justify-content: flex-end; /* pousse le bouton à droite */
    margin-top: 20px;          /* espacement au-dessus */
    margin-bottom: 20px;       /* espacement en dessous */
}

/* Style optionnel pour le bouton */
.bouton-droite button {
    width: 200px;
    font-weight: 600;
    border: none;
    border-radius: 50px;       /* arrondi */
    box-shadow: 0 2px 6px rgba(0,0,0,0.2);
}
</style>
	{% endblock %}
{% endblock %}

{% block title %}détail demande
{% endblock %}

{% block Header %}
	{{ parent() }}
{% endblock %}

{% block page %}
	{{ parent() }}
	{% block loader %}
		{{ parent() }}
	{% endblock %}

	{% if app.user %}
		{% if is_granted('ROLE_VENDEUR_NEUF') %}
<section class="py-5">
    <div class="container d-flex flex-column min-vh-100"> {# min-vh-100 = hauteur de l'écran #}
        <div class="aiz-user-panel flex-grow-1 d-flex flex-column">

        <!-- TITRE CENTRÉ -->
        <h2 class="mb-4 text-center" style="font-weight:700; color:#333;">
            Détail de la demande – N°{{ demande.code }}
        </h2>

        <!-- RÉCAPITULATIF -->
        <div class="card mb-4">
            <div class="card-header">
                <h5 class="h6 mb-0">Récapitulatif de la demande</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-lg-6">
                        <table class="table-borderless table">
                            <tbody>
                                <tr><td class="w-50 fw-600">Code de demande:</td><td>{{ demande.code }}</td></tr>
                                <tr><td class="w-50 fw-600">Marque:</td><td>{{ demande.marque }}</td></tr>
                                <tr><td class="w-50 fw-600">Modèle:</td><td>{{ demande.modele }}</td></tr>
                                <tr><td class="w-50 fw-600">N° Châssis:</td><td>{{ demande.chassis }}</td></tr>
                                <tr><td class="w-50 fw-600">Énergie / Carburant:</td><td>{{ demande.energie }}</td></tr>
                                <tr><td class="w-50 fw-600">État du moteur:</td><td>{{ demande.etatmoteur }}</td></tr>
                                <tr><td class="w-50 fw-600">Zone:</td><td>{{ demande.zone }}</td></tr>
                            </tbody>
                        </table>
                    </div>
                    <div class="col-lg-6">
                        <table class="table-borderless table">
                            <tbody>
                                <tr><td class="w-50 fw-600">Date de demande:</td><td>{{ demande.datecreate|date('d/m/Y H:i') }}</td></tr>
                                <tr><td class="w-50 fw-600">Statut:</td>
                                    <td>{% if demande.statut == 'en_attente' %}
                                            <span class="badge badge-inline badge-warning">en attente</span>
                                             {% elseif demande.statut == 'publié' %}
                                              <span class="badge badge-inline badge-info ">publié</span>
                                        {% elseif demande.statut == 'fermer' %}
                                            <span class="badge badge-inline badge-success">Servue</span>
                                        {% endif %}</td>
                                </tr>
                                <tr><td class="w-50 fw-600">Photo carte grise:</td><td>{% if demande.photocartegrise %}
    <img src="{{ demande.photocartegrise }}" 
         alt="Carte grise" 
         style="width:222px;height:135px;border-radius:6px;">
{% else %}
    -
{% endif %}
</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- TABLEAU DES PIÈCES -->
        <div class="card flex-grow-1 mb-4">
            <div class="card-header">
                <h5 class="h6 mb-0">Détails de la demande</h5>
            </div>
            <div class="card-body flex-grow-1">
                <table class="table table-striped" id="tabprod1">
                    <thead>
                        <tr><th>#</th><th>Désignation</th><th>Référence</th><th>Photo</th><th>Observation</th></tr>
                    </thead>
                    <tbody>
                        {% for piece in pieces %}
                            <tr>
                                <td>{{ loop.index }}</td>
                                <td>{{ piece.designation }}</td>
                                <td>{{ piece.referance }}</td>
                                <td>{% if piece.photo %}<img src="{{ asset(piece.photo) }}" width="80">{% else %}-{% endif %}</td>
                                <td>{{ piece.observation ?: '-' }}</td>
                            </tr>
                        {% else %}
                            <tr><td colspan="5" class="text-center">Aucune pièce trouvée</td></tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>

        <!-- BOUTON À DROITE DANS LE FLUX -->
        <div class="mt-3 mb-4 bouton-droite">
            {% set dejaPropose = demande.offres|filter(o => o.user.id == app.user.id)|length > 0 %}
            {% if dejaPropose %}
                <button type="button" class="btn btn-primary rounded-pill shadow-sm"
                        onclick="AIZ.plugins.notify('danger', 'Vous avez déjà proposé une offre pour cette demande !');"
                        style="background: linear-gradient(90deg,#007bff,#00c6ff); border:none; font-weight:600; width:200px;">
                    Proposer un prix
                </button>
            {% else %}
                <form action="{{ path('propose_offre', {'code': demande.code}) }}" class="d-inline">
                    <button type="submit" class="btn btn-primary rounded-pill shadow-sm"
                            style="background: linear-gradient(90deg,#007bff,#00c6ff); border:none; font-weight:600; width:200px;">
                        Proposer un prix
                    </button>
                </form>
            {% endif %}
        </div>


        </div>
    </div>
</section>

{% endif %}

	{% endif %}
{% endblock %}

{% block footer %}
	{{ parent() }}
{% endblock %}

{% block javascript %}
	{{ parent() }}
	<script type="text/javascript" src="{{ asset('assets/js/carousel.js') }}"></script>
	<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
	<script type="text/javascript">
		$(document).ready(function () {
var table = $('#tabprod1').DataTable({
language: {
processing: "Traitement en cours...",
search: "Rechercher :",
lengthMenu: "Afficher _MENU_ éléments",
info: " _START_-_END_/_TOTAL_ éléments",
infoEmpty: " 0 -  0 / 0 éléments",
infoFiltered: "(filtré de _MAX_ éléments au total)",
zeroRecords: "Aucun élément à afficher",
emptyTable: "Aucun élément à afficher",
paginate: {
first: "Premier",
previous: "Précédent",
next: "Suivant",
last: "Dernier"
}
},
rowReorder: {
selector: 'td:nth-child(2)'
},
responsive: true
});
});
	</script>
{% endblock %}

