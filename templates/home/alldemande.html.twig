{% extends 'layout.html.twig' %}

{% block title %}Carhabty
{% endblock %}

{% block LinksCss %}
	{{ parent() }}
	<link type="text/css" rel="stylesheet" href="{{ asset ('css/popup.css')}}">
	<link rel="stylesheet" href="{{ asset ('css/stylebutton.css') }}">
<style>

.filter-center {
    flex-wrap: nowrap;
}

.form-select-sm {
    min-width: 150px;
    border-radius: 8px;
    border: 1px solid #ddd;
    transition: all 0.2s ease-in-out;
}

.form-select-sm:hover {
    border-color: #ff6b35;
    box-shadow: 0 0 5px rgba(255,107,53,0.4);
}

.form-label {
    font-weight: 500;
    color: #444;
}

		.request-card {
			background: linear-gradient(135deg, #ffffff, #f7f8fc);
			border-radius: 15px;
			box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
			padding: 15px;
			transition: all 0.3s ease;
		}

		.request-card:hover {
			transform: translateY(-4px);
			box-shadow: 0 8px 20px rgba(255, 107, 53, 0.3);
		}

		.request-header {
			display: flex;
			justify-content: space-between;
			align-items: center;
			margin-bottom: 10px;
		}

		.request-title {
			font-weight: 700;
			font-size: 16px;
			color: #222;
			line-height: 1.3;
			flex: 1;
		}

		.request-badge {
			background: linear-gradient(135deg, #ff6b35 0%, #fca311 50%, #2ec4b6 100%);
			color: #fff;
			font-size: 12px;
			border-radius: 12px;
			padding: 5px 12px;
			font-weight: 700;
			letter-spacing: 0.5px;
			text-transform: uppercase;
			box-shadow: 0 2px 6px rgba(0, 0, 0, 0.15);
			display: inline-block;
			transition: all 0.3s ease;
		}

		.request-badge:hover {
			transform: scale(1.05);
			box-shadow: 0 4px 10px rgba(0, 0, 0, 0.25);
		}
		.request-header {
			display: flex;
			justify-content: space-between;
			align-items: center;
			margin-bottom: 8px;
		}


		.request-meta {
			font-size: 13px;
			color: #666;
			display: flex;
			justify-content: space-between;
			flex-wrap: wrap;
			gap: 4px;
			margin-bottom: 10px;
		}

		.request-image img {
			width: 100%;
			height: 220px;
			object-fit: cover;
			border-radius: 10px;
			margin-bottom: 10px;
		}

		.request-description {
			font-size: 14px;
			color: #333;
			line-height: 1.4;
			min-height: 50px;
			margin-bottom: 10px;
		}

		.request-meta {
			display: flex;
			flex-wrap: wrap;
			gap: 10px;
			color: #555;
			font-size: 14px;
			align-items: center;
			margin-bottom: 10px;
		}

		.request-meta i {
			color: #ff6b35;
			margin-right: 5px;
			font-size: 15px;
		}

		.btn-register i {
			margin-right: 8px;
			font-size: 16px;
			color: #fff;
		}
		.btn-register {
			background: linear-gradient(45deg, #ff6b35, #ff8c00);
			border: none;
			color: white;
			font-weight: 600;
			transition: 0.3s ease;
		}
		.btn-register:hover {
			background: linear-gradient(45deg, #ff8c00, #ff6b35);
			transform: translateY(-2px);
		}
		/* Effet au survol */
		.btn-register:hover {
			background: linear-gradient(45deg, #ff8c00, #ff6b35);
			transform: translateY(-2px);
			box-shadow: 0 4px 10px rgba(255, 107, 53, 0.4);
		}

		/* Animation de l'enveloppe quand la carte est survol√©e */
		.request-card:hover .btn-register i {
			animation: vibrate 0.3s linear infinite;
		}

		@keyframes vibrate {
			0% {
				transform: rotate(0deg);
			}
			25% {
				transform: rotate(10deg);
			}
			50% {
				transform: rotate(-10deg);
			}
			75% {
				transform: rotate(10deg);
			}
			100% {
				transform: rotate(0deg);
			}
		}
		/* üì± Responsive fixes */
		@media(max-width: 768px) {
			.request-card {
				padding: 12px;
				min-height: auto;
			}
			.request-title {
				font-size: 15px;
			}
			.request-meta {
				font-size: 12px;
			}
			.request-image img {
				height: 180px;
			}
		}


		.btn-propdemande {
			background: linear-gradient(45deg, #ff6b35, #ff9f1c);
			background: linear-gradient(45deg, #2ec4b6, #ff9f1c);
			color: white;
			box-shadow: 0 4px 15px rgba(255, 107, 53, 0.3);
		}


		.btn-offer {
			background-color: #ff4d00;
			color: white;
			border: none;
			width: 100%;
			padding: 10px;
			border-radius: 10px;
			font-weight: 600;
			cursor: pointer;
			transition: background 0.2s ease;
		}
		.btn-offer:hover {
			background-color: #e64300;
		}

		.badge-custom {
			display: inline-block;
			padding: 3px;
			font-size: 11px;
			border-radius: 0 50em 50em 0;
			color: #ffffff;
			font-weight: 600;
			line-height: 23px;
			position: absolute;
			background: linear-gradient(45deg, #ff6b35, #ff9f1c);
			z-index: 1;
			top: 20px;
			box-shadow: 2px 1px 6px 2px rgb(0 0 0 / 10%), 0 4px 4px 0 rgb(0 0 0 / 15%) !important;
		}
		.badge-custom .box {
			height: 26px;
			width: 26px;
			background: linear-gradient(45deg, #ff6b35, #ff9f1c);
			color: #fff;
			display: inline-block;
			border-radius: 50%;
			text-align: center;
		}
	</style>
{% endblock %}

{% block Content %}
	<section class="mb-4 pt-3">
    <div class="container px-2">
        <form id="search-form" action="" method="GET">
            <div class="row">
                <div class="col-12">

                    <!-- üîπ Titre centr√© -->
                    <div class="text-center mb-3">
                        <h1 class="h5 fw-bold text-body mb-0">
                            üßæ Toutes les Demandes
                        </h1>
                    </div>

                    <!-- üîπ Filtres centr√©s sur une ligne -->
                    <div class="mb-4 border-bottom pb-3">
                        <div class="d-flex justify-content-center align-items-end gap-3 flex-wrap filter-center">

                            <!-- Marque -->
                            <div>
                                <label class="form-label small opacity-75 mb-1">Marque</label>
                                <select class="form-select form-select-sm" onchange="filter()" id="marque" name="brand">
                                    <option value="">Toutes les marques</option>
                                    <option value="Audi">Audi</option>
                                    <option value="BMW">BMW</option>
                                    <option value="Mercedes">Mercedes</option>
                                    <option value="Toyota">Toyota</option>
                                    <option value="Volkswagen">Volkswagen</option>
                                </select>
                            </div>

                            <!-- √âtat -->
                            <div>
                                <label class="form-label small opacity-75 mb-1">√âtat</label>
                                <select class="form-select form-select-sm" onchange="filter()" id="etat" name="etat">
                                    <option value="">Tous</option>
                                    <option value="neuf">Neuf</option>
                                    <option value="occasion">Occasion</option>
                                </select>
                            </div>

                            <!-- Zone -->
                            <div>
                                <label class="form-label small opacity-75 mb-1">Zone</label>
                                <select class="form-select form-select-sm" onchange="filter()" id="zone" name="zone">
                                    <option value="">Toute la Tunisie</option>
                                    <option value="Tunis">Tunis</option>
                                    <option value="Sfax">Sfax</option>
                                    <option value="Sousse">Sousse</option>
                                    <option value="Nabeul">Nabeul</option>
                                    <option value="Gab√®s">Gab√®s</option>
                                    <option value="Bizerte">Bizerte</option>
                                    <option value="Kairouan">Kairouan</option>
                                    <option value="Mahdia">Mahdia</option>
                                </select>
                            </div>

                            <!-- Tri -->
                            <div>
                                <label class="form-label small opacity-75 mb-1">Trier par</label>
                                <select class="form-select form-select-sm" onchange="filter()" name="sort_by" id="trier">
                                    <option value="date-desc">Date d√©croissante</option>
                                    <option value="date-asc">Date croissante</option>
                                </select>
                            </div>

                        </div>
                    </div>

                    <!-- üî∏ Liste des demandes -->
                    <div class="row g-4" id="filterrech">
                        {% for demande in lastDemandes %}
                            <div class="col-xl-4 col-lg-4 col-md-6 col-sm-12">
                                <div class="request-card shadow-sm h-100">
                                    <div class="request-header d-flex justify-content-between align-items-center">
                                        <div class="request-title fw-bold">
                                            {% if demande.pieces|length > 0 %}
                                                {% for piece in demande.pieces %}
                                                    {{ piece.designation }}{% if not loop.last %}, {% endif %}
                                                {% endfor %}
                                            {% else %}
                                                {{ demande.marque }} {{ demande.modele }}
                                            {% endif %}
                                        </div>
                                        <div class="request-badge">
                                            {% if demande.vendeuroccasion == 1 %}
                                                Occasion
                                            {% else %}
                                                Neuf
                                            {% endif %}
                                        </div>
                                    </div>

                                    <div class="request-meta small text-muted mt-1">
                                        <span><i class="fas fa-map-marker-alt text-primary me-1"></i>{{ demande.zone }}</span>
                                        <span class="ms-2"><i class="fas fa-user text-primary me-1"></i>{{ demande.offrecompte ? demande.offrecompte.nom : 'Anonyme' }}</span>
                                        <span class="ms-2"><i class="far fa-clock text-primary me-1"></i>{{ demande.datecreate|time_ago }}</span>
                                    </div>

                                    <div class="request-image my-2">
                                        {% set photo = (demande.Pieces|first).photo ?? '/assets/img/placeholder.png' %}
                                        <img src="{{ photo }}" alt="photo" class="img-fluid rounded w-100" style="height:200px; object-fit:cover;">
                                    </div>

                                    <p class="request-description small text-secondary px-1">
                                        {% if demande.pieces|length > 0 %}
                                            {% for piece in demande.pieces|slice(0,3) %}
                                                {{ piece.observation }}{% if not loop.last %}, {% endif %}
                                            {% endfor %}
                                            {% if demande.pieces|length > 3 %}...{% endif %}
                                        {% else %}
                                            Pas de description disponible.
                                        {% endif %}
                                    </p>

                                    <button class="btn btn-register w-100 mt-auto">
                                        <i class="fas fa-envelope-open-text vibrate-icon"></i>
                                        Proposer un prix
                                    </button>
                                </div>
                            </div>
                        {% else %}
                            <p class="text-center text-muted">Aucune demande trouv√©e.</p>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </form>
    </div>
</section>

{% endblock %}
{% block javascript %}
	{{ parent() }}
	<script type="text/javascript"></script>
{% endblock %}

